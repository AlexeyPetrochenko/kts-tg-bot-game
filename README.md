# üéÆ Telegram Game Bot: –ü–æ–ª–µ —á—É–¥–µ—Å

–ü—Ä–æ–µ–∫—Ç Telegram-–±–æ—Ç–∞ –¥–ª—è –∏–≥—Ä—ã –≤ —Å—Ç–∏–ª–µ ¬´–ü–æ–ª–µ —á—É–¥–µ—Å¬ª, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π **–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Telegram SDK** ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Ä–∞–±–æ—Ç—É —Å Telegram Bot API –ø—Ä–∏ –ø–æ–º–æ—â–∏ `aiohttp`.

## üöÄ –û–ø–∏—Å–∞–Ω–∏–µ

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã Telegram Bot API, —Å–∏—Å—Ç–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ –≤ –∏–≥—Ä–µ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Ç–∞—Ö, —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `–∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM)` –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üõ∞Ô∏è **–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Telegram Long Poller**
  –û—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram Bot API –∏ —Å—Ç–∞–≤–∏—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å RabbitMQ.

- ‚öôÔ∏è **–í–æ—Ä–∫–µ—Ä—ã –ª–æ–≥–∏–∫–∏ —Å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π**
  –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö (`handlers`) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∏ callback-—Å–æ–æ–±—â–µ–Ω–∏–π;
  - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FSM –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –∏–≥—Ä—ã;
  - —Ç–∞–π–º–µ—Ä–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π –ø–æ —á–∞—Ç–∞–º.

- üìä **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏**
  –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω –∏–∑ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ —Ö–µ—à—É –Ω–æ–º–µ—Ä–∞ —á–∞—Ç–∞ ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

- üõ†Ô∏è **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤**
  –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ `aiohttp`:
  - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `aiohttp-session[secure]`;
  - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —á–µ—Ä–µ–∑ `aiohttp-apispec` –∏ `marshmallow`.

- üê≥ **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
  - –°–æ–±—Ä–∞–Ω–∞ –Ω–∞ –±–∞–∑–µ `Docker` –∏ `docker-compose`;
  - –ü–æ–¥–∫–ª—é—á—ë–Ω —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: `Grafana`, `Loki`, `Prometheus`, `Alloy`;
  - –ù–∞—Å—Ç—Ä–æ–µ–Ω CI/CD pipeline –∏ –≤—ã–∫–∞—Ç–∫–∞ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.

- üèÅ **–ò—Ç–æ–≥**
  –ü—Ä–æ–µ–∫—Ç –±—ã–ª –∑–∞—â–∏—â—ë–Ω –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å–∞ –∏ –ø—Ä–æ—à—ë–ª –æ—Ç–±–æ—Ä –Ω–∞ —ç—Ç–∞–ø —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è.

## ‚öôÔ∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **–Ø–∑—ã–∫–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: Python 3.12, asyncio, aiohttp
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Telegram**: Telegram Bot API (–±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫)
- **–û—á–µ—Ä–µ–¥–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: RabbitMQ
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL, SQLAlchemy, Alembic
- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Passlib
- **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: Marshmallow
- **–î–æ–∫–µ—Ä–∏–∑–∞—Ü–∏—è –∏ CI/CD**: Docker, Docker Compose, GitHub Actions
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Grafana, Loki, Prometheus, Alloy
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: Ruff
- **–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: uv

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:**

    ```bash
    git clone https://github.com/AlexeyPetrochenko/kts-tg-bot-game
    cd kts-tg-bot-game
    ```

2. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞** –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ:

    ```env
    DB_HOST=db
    DB_USER=kts_user
    DB_PASS=kts_pass
    DB_NAME=tg_game

    RMQ_HOST=broker
    RMQ_USER=guest
    RMQ_PASS=guest
    RMQ_PORT=5672

    IMAGE_TAG=v1.0.0
    ```

    > `.env` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è Docker**. –ó–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å `etc/config.yaml`.

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram-–±–æ—Ç–∞:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ [@BotFather](https://t.me/BotFather);
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º;
   - –ü–æ–ª—É—á–∏—Ç–µ **API Token** ‚Äî –æ–Ω –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞;
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞ –æ—Ç–∫–ª—é—á–∏—Ç–µ **Privacy Mode**, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –≤–∏–¥–µ—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö.

4. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `etc/config.yaml`** (–æ–Ω —É–∂–µ –µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏) –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–µ–π–∫–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ –±–ª–æ–∫–µ:

    ```yaml
    bot:
      token: <your_secret_token>
    ```

    > –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é Docker Compose:**

    ```bash
    docker-compose up --build
    ```

6. **–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
   - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–∞–∑–æ–≤—ã–π –∞–¥–º–∏–Ω: `admin@admin.com / admin`;
   - –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å;
   - –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É —Å –±–æ—Ç–æ–º;
   - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ API.

7. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –°—Ç–µ–∫ `Grafana + Prometheus + Loki` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏;
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## üë• –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ—á–µ–Ω–∫–æ** ‚Äî Backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫.
–ö–æ–Ω—Ç–∞–∫—Ç—ã:
[GitHub](https://github.com/AlexeyPetrochenko) | [Telegram](https://t.me/AlekseyPetrochenko) | [alexeypetrochenko1@gmail.com](mailto:alexeypetrochenko1@gmail.com)
